<div class="company-page">
  <!-- Breadcrumb -->
  <div class="breadcrumb-section">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="javascript:void(0)">Admin</a></li>
        <li class="breadcrumb-item"><a href="/setup">Setup</a></li>
        <li class="breadcrumb-item"><a href="/setup/company">Company Management</a></li>
        <li class="breadcrumb-item active">
          {{ mode === 'create' ? 'Add Company' : mode === 'edit' ? 'Edit Company' : 'Company Details' }}
        </li>
      </ol>
    </nav>
  </div>

  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-building me-2"></i>
        {{ mode === 'create' ? 'Add Company' : mode === 'edit' ? 'Edit Company' : 'Company Details' }}
      </h1>
      <p class="text-muted">
        {{ mode === 'create' ? 'Configure your company details for the system' : 
           mode === 'edit' ? 'Update your company information and settings' : 
           'View company information and settings' }}
      </p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline-secondary me-2" (click)="onCancel()">
        <i class="fas fa-arrow-left me-2"></i>
        Back to List
      </button>
      <button *ngIf="mode === 'edit'" class="btn btn-outline-primary" (click)="onViewMode()">
        <i class="fas fa-eye me-2"></i>
        View Mode
      </button>
      <button *ngIf="mode === 'view'" class="btn btn-outline-primary" (click)="onEditMode()">
        <i class="fas fa-edit me-2"></i>
        Edit Mode
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="state-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading company data...</p>
  </div>

  <!-- Form Content -->
  <div *ngIf="!isLoading" class="content-area">
    <div class="content-body">
      <!-- Alert Messages -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ errorMessage }}
        <div class="mt-2">
          <button 
            type="button" 
            class="btn btn-outline-light btn-sm me-2"
            (click)="refreshCompanyData()"
            [disabled]="isLoading"
          >
            <i class="fas fa-refresh me-1"></i>
            Try Again
          </button>
          <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
        </div>
      </div>

      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
      </div>

      <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" class="company-form">
        <div class="card form-card">
          <div class="card-header">
            <h5 class="card-title">
              <i class="fas fa-building me-2"></i>
              Company Information
            </h5>
          </div>
          <div class="card-body">
            <!-- Logo Upload Section -->
            <div class="row mb-4">
              <div class="col-12">
                <div class="logo-section">
                  <div class="row align-items-center">
                    <div class="col-md-3 text-center">
                      <div class="logo-preview-container">
                        <div class="logo-preview-wrapper">
                          <img 
                            *ngIf="fileUpload.preview || currentCompany?.CompanyLogo"
                            [src]="fileUpload.preview || (currentCompany?.CompanyLogo ?? '/assets/images/default-app-icon.png')" 
                            alt="Company Logo"
                            class="logo-preview-image"
                            onerror="this.src='/assets/images/default-app-icon.png'"
                          >
                          <div *ngIf="!fileUpload.preview && !currentCompany?.CompanyLogo" class="logo-placeholder">
                            <i class="fas fa-building"></i>
                          </div>
                        </div>
                        <button 
                          *ngIf="mode !== 'view' && (fileUpload.preview || currentCompany?.CompanyLogo)"
                          type="button" 
                          class="btn-remove-logo"
                          (click)="removeFile()"
                          title="Remove Logo"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>
                    <div class="col-md-9">
                      <div class="logo-upload-content">
                        <h6 class="logo-title">Company Logo</h6>
                        <p class="logo-subtitle">Upload your company logo (JPG, PNG, or GIF - Max 5MB)</p>
                        
                        <div *ngIf="mode !== 'view'" class="logo-upload-actions">
                          <div class="file-input-wrapper">
                            <input
                              type="file"
                              id="companyLogo"
                              accept="image/jpeg,image/jpg,image/png,image/gif"
                              (change)="onFileSelected($event)"
                              class="logo-file-input"
                            >
                            <label for="companyLogo" class="btn btn-primary btn-logo-upload">
                              <i class="fas fa-upload me-2"></i>
                              {{ fileUpload.name ? 'Change Logo' : 'Choose Logo' }}
                            </label>
                          </div>
                          
                          <div *ngIf="fileUpload.name" class="file-info">
                            <small class="text-muted">
                              <i class="fas fa-file me-1"></i>
                              {{ fileUpload.name }}
                            </small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Company Details Form - Three Input Boxes Per Line -->
            <div class="three-column-form">
              <!-- Row 1: Company Name, ABBR, Tax ID -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="CompanyName" class="form-label required">Company Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="CompanyName"
                    formControlName="CompanyName"
                    placeholder="Enter company name"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['CompanyName']?.touched && f['CompanyName']?.invalid" class="form-error">
                    <small *ngIf="f['CompanyName']?.errors?.['required']">Company name is required</small>
                    <small *ngIf="f['CompanyName']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="ABBR" class="form-label required">Company ABBR</label>
                  <input
                    type="text"
                    class="form-control"
                    id="ABBR"
                    formControlName="ABBR"
                    placeholder="Enter company abbreviation"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['ABBR']?.touched && f['ABBR']?.invalid" class="form-error">
                    <small *ngIf="f['ABBR']?.errors?.['required']">Company ABBR is required</small>
                    <small *ngIf="f['ABBR']?.errors?.['maxlength']">Cannot exceed 50 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="TaxId" class="form-label">Tax ID</label>
                  <input
                    type="text"
                    class="form-control"
                    id="TaxId"
                    formControlName="TaxId"
                    placeholder="Enter tax ID"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['TaxId']?.touched && f['TaxId']?.invalid" class="form-error">
                    <small *ngIf="f['TaxId']?.errors?.['maxlength']">Cannot exceed 50 characters</small>
                  </div>
                </div>
              </div>

              <!-- Row 2: Domain, Date of Establishment, Date of Incorporation -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="Domain" class="form-label">Domain</label>
                  <input
                    type="text"
                    class="form-control"
                    id="Domain"
                    formControlName="Domain"
                    placeholder="Enter company domain"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['Domain']?.touched && f['Domain']?.invalid" class="form-error">
                    <small *ngIf="f['Domain']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="DateOfEstablishment" class="form-label">Date of Establishment</label>
                  <input
                    type="date"
                    class="form-control"
                    id="DateOfEstablishment"
                    formControlName="DateOfEstablishment"
                    [disabled]="mode === 'view'"
                  >
                </div>
                <div class="form-field">
                  <label for="DateOfIncorporation" class="form-label">Date of Incorporation</label>
                  <input
                    type="date"
                    class="form-control"
                    id="DateOfIncorporation"
                    formControlName="DateOfIncorporation"
                    [disabled]="mode === 'view'"
                  >
                </div>
              </div>

              <!-- Row 3: Address Line 1, Address Line 2, City -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="AddressLine1" class="form-label">Address Line 1</label>
                  <input
                    type="text"
                    class="form-control"
                    id="AddressLine1"
                    formControlName="AddressLine1"
                    placeholder="Enter address line 1"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['AddressLine1']?.touched && f['AddressLine1']?.invalid" class="form-error">
                    <small *ngIf="f['AddressLine1']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="AddressLine2" class="form-label">Address Line 2</label>
                  <input
                    type="text"
                    class="form-control"
                    id="AddressLine2"
                    formControlName="AddressLine2"
                    placeholder="Enter address line 2 (optional)"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['AddressLine2']?.touched && f['AddressLine2']?.invalid" class="form-error">
                    <small *ngIf="f['AddressLine2']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="City" class="form-label">City</label>
                  <input
                    type="text"
                    class="form-control"
                    id="City"
                    formControlName="City"
                    placeholder="Enter city"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['City']?.touched && f['City']?.invalid" class="form-error">
                    <small *ngIf="f['City']?.errors?.['maxlength']">Cannot exceed 100 characters</small>
                  </div>
                </div>
              </div>

              <!-- Row 4: State, Country, Postal Code -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="State" class="form-label">State</label>
                  <input
                    type="text"
                    class="form-control"
                    id="State"
                    formControlName="State"
                    placeholder="Enter state"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['State']?.touched && f['State']?.invalid" class="form-error">
                    <small *ngIf="f['State']?.errors?.['maxlength']">Cannot exceed 100 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="Country" class="form-label">Country</label>
                  <input
                    type="text"
                    class="form-control"
                    id="Country"
                    formControlName="Country"
                    placeholder="Enter country"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['Country']?.touched && f['Country']?.invalid" class="form-error">
                    <small *ngIf="f['Country']?.errors?.['maxlength']">Cannot exceed 100 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="PostalCode" class="form-label">Postal Code</label>
                  <input
                    type="text"
                    class="form-control"
                    id="PostalCode"
                    formControlName="PostalCode"
                    placeholder="Enter postal code"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['PostalCode']?.touched && f['PostalCode']?.invalid" class="form-error">
                    <small *ngIf="f['PostalCode']?.errors?.['maxlength']">Cannot exceed 20 characters</small>
                  </div>
                </div>
              </div>

              <!-- Row 5: Email Address, Phone Number, Fax -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="EmailAddress" class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-control"
                    id="EmailAddress"
                    formControlName="EmailAddress"
                    placeholder="Enter email address"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['EmailAddress']?.touched && f['EmailAddress']?.invalid" class="form-error">
                    <small *ngIf="f['EmailAddress']?.errors?.['email']">Please enter a valid email address</small>
                    <small *ngIf="f['EmailAddress']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="PhoneNumber" class="form-label">Phone Number</label>
                  <input
                    type="tel"
                    class="form-control"
                    id="PhoneNumber"
                    formControlName="PhoneNumber"
                    placeholder="Enter phone number"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['PhoneNumber']?.touched && f['PhoneNumber']?.invalid" class="form-error">
                    <small *ngIf="f['PhoneNumber']?.errors?.['maxlength']">Cannot exceed 20 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <label for="Fax" class="form-label">Fax</label>
                  <input
                    type="text"
                    class="form-control"
                    id="Fax"
                    formControlName="Fax"
                    placeholder="Enter fax number"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['Fax']?.touched && f['Fax']?.invalid" class="form-error">
                    <small *ngIf="f['Fax']?.errors?.['maxlength']">Cannot exceed 20 characters</small>
                  </div>
                </div>
              </div>

              <!-- Row 6: Website (with empty spaces to maintain 3-column layout) -->
              <div class="form-triplet">
                <div class="form-field">
                  <label for="Website" class="form-label">Website</label>
                  <input
                    type="url"
                    class="form-control"
                    id="Website"
                    formControlName="Website"
                    placeholder="Enter website URL"
                    [disabled]="mode === 'view'"
                  >
                  <div *ngIf="f['Website']?.touched && f['Website']?.invalid" class="form-error">
                    <small *ngIf="f['Website']?.errors?.['maxlength']">Cannot exceed 255 characters</small>
                  </div>
                </div>
                <div class="form-field">
                  <!-- Empty space to maintain 3-column layout -->
                </div>
                <div class="form-field">
                  <!-- Empty space to maintain 3-column layout -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div *ngIf="mode !== 'view'" class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary me-2"
            (click)="onCancel()"
            [disabled]="isSubmitting"
          >
            <i class="fas fa-arrow-left me-2"></i>
            Cancel
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isSubmitting || companyForm.invalid"
          >
            <i class="fas fa-save me-2"></i>
            {{ isSubmitting ? 'Saving...' : (currentCompany ? 'Update Company' : 'Create Company') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>