<div class="company-page">
  <!-- Breadcrumb -->
  <div class="breadcrumb-section">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="javascript:void(0)">Admin</a></li>
        <li class="breadcrumb-item"><a href="/setup">Setup</a></li>
        <li class="breadcrumb-item active">Company Settings</li>
      </ol>
    </nav>
  </div>

  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-building me-2"></i>
        {{ currentCompany ? 'Edit Company' : 'Add Company' }}
      </h1>
      <p class="text-muted">
        {{ currentCompany ? 'Update your company information and settings' : 'Configure your company details for the system' }}
      </p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="state-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p>Loading company data...</p>
  </div>

  <!-- Form Content -->
  <div *ngIf="!isLoading" class="content-area">
    <div class="content-body">
      <!-- Alert Messages -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ errorMessage }}
        <div class="mt-2">
          <button 
            type="button" 
            class="btn btn-outline-light btn-sm me-2"
            (click)="refreshCompanyData()"
            [disabled]="isLoading"
          >
            <i class="fas fa-refresh me-1"></i>
            Try Again
          </button>
          <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
        </div>
      </div>

      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''" aria-label="Close"></button>
      </div>

      <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" class="company-form">
        <div class="row">
          <!-- Company Logo Section -->
          <div class="col-lg-4">
            <div class="card logo-card">
              <div class="card-header">
                <h5 class="card-title">
                  <i class="fas fa-image me-2"></i>
                  Company Logo
                </h5>
              </div>
              <div class="card-body">
                <div class="logo-upload-area">
                  <!-- Logo Preview -->
                  <div *ngIf="fileUpload.preview || currentCompany?.CompanyLogo" class="logo-preview">
                    <img 
                      [src]="fileUpload.preview || (currentCompany?.CompanyLogo ?? '/assets/images/default-app-icon.png')" 
                      alt="Company Logo"
                      class="preview-image"
                      onerror="this.src='/assets/images/default-app-icon.png'"
                    >
                    <button 
                      type="button" 
                      class="btn-remove-logo"
                      (click)="removeFile()"
                      title="Remove Logo"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>

                  <!-- Upload Instructions -->
                  <div *ngIf="!fileUpload.preview && !currentCompany?.CompanyLogo" class="upload-instructions">
                    <div class="upload-icon">
                      <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p class="upload-text">Upload Company Logo</p>
                    <p class="upload-hint">JPG, PNG or GIF (Max 5MB)</p>
                  </div>

                  <!-- File Input -->
                  <div class="file-input-group">
                    <input
                      type="file"
                      id="companyLogo"
                      accept="image/jpeg,image/jpg,image/png,image/gif"
                      (change)="onFileSelected($event)"
                      class="form-control"
                    >
                    <label for="companyLogo" class="btn btn-primary btn-upload">
                      <i class="fas fa-upload me-2"></i>
                      {{ fileUpload.name ? 'Change Logo' : 'Choose Logo' }}
                    </label>
                  </div>

                  <!-- File Info -->
                  <div *ngIf="fileUpload.name" class="file-info">
                    <small class="text-muted">
                      <i class="fas fa-file me-1"></i>
                      {{ fileUpload.name }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Company Details Form -->
          <div class="col-lg-8">
            <div class="card form-card">
              <div class="card-header">
                <h5 class="card-title">
                  <i class="fas fa-info-circle me-2"></i>
                  Company Information
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <!-- Basic Information -->
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="CompanyName" class="form-label required">Company Name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="CompanyName"
                        formControlName="CompanyName"
                        placeholder="Enter company name"
                      >
            <div *ngIf="f['CompanyName']?.touched && f['CompanyName']?.invalid" class="text-danger">
              <small *ngIf="f['CompanyName']?.errors?.['required']">Company name is required</small>
              <small *ngIf="f['CompanyName']?.errors?.['maxlength']">Company name cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="ABBR" class="form-label required">Company ABBR</label>
                      <input
                        type="text"
                        class="form-control"
                        id="ABBR"
                        formControlName="ABBR"
                        placeholder="Enter company abbreviation"
                      >
            <div *ngIf="f['ABBR']?.touched && f['ABBR']?.invalid" class="text-danger">
              <small *ngIf="f['ABBR']?.errors?.['required']">Company ABBR is required</small>
              <small *ngIf="f['ABBR']?.errors?.['maxlength']">ABBR cannot exceed 50 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="TaxId" class="form-label">Tax ID</label>
                      <input
                        type="text"
                        class="form-control"
                        id="TaxId"
                        formControlName="TaxId"
                        placeholder="Enter tax ID"
                      >
            <div *ngIf="f['TaxId']?.touched && f['TaxId']?.invalid" class="text-danger">
              <small *ngIf="f['TaxId']?.errors?.['maxlength']">Tax ID cannot exceed 50 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="Domain" class="form-label">Domain</label>
                      <input
                        type="text"
                        class="form-control"
                        id="Domain"
                        formControlName="Domain"
                        placeholder="Enter company domain"
                      >
            <div *ngIf="f['Domain']?.touched && f['Domain']?.invalid" class="text-danger">
              <small *ngIf="f['Domain']?.errors?.['maxlength']">Domain cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>

                  <!-- Date Fields -->
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="DateOfEstablishment" class="form-label">Date of Establishment</label>
                      <input
                        type="date"
                        class="form-control"
                        id="DateOfEstablishment"
                        formControlName="DateOfEstablishment"
                      >
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="DateOfIncorporation" class="form-label">Date of Incorporation</label>
                      <input
                        type="date"
                        class="form-control"
                        id="DateOfIncorporation"
                        formControlName="DateOfIncorporation"
                      >
                    </div>
                  </div>

                  <!-- Address Information -->
                  <div class="col-12">
                    <div class="mb-3">
                      <label for="AddressLine1" class="form-label">Address Line 1</label>
                      <input
                        type="text"
                        class="form-control"
                        id="AddressLine1"
                        formControlName="AddressLine1"
                        placeholder="Enter address line 1"
                      >
            <div *ngIf="f['AddressLine1']?.touched && f['AddressLine1']?.invalid" class="text-danger">
              <small *ngIf="f['AddressLine1']?.errors?.['maxlength']">Address line 1 cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="mb-3">
                      <label for="AddressLine2" class="form-label">Address Line 2</label>
                      <input
                        type="text"
                        class="form-control"
                        id="AddressLine2"
                        formControlName="AddressLine2"
                        placeholder="Enter address line 2 (optional)"
                      >
            <div *ngIf="f['AddressLine2']?.touched && f['AddressLine2']?.invalid" class="text-danger">
              <small *ngIf="f['AddressLine2']?.errors?.['maxlength']">Address line 2 cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="City" class="form-label">City</label>
                      <input
                        type="text"
                        class="form-control"
                        id="City"
                        formControlName="City"
                        placeholder="Enter city"
                      >
            <div *ngIf="f['City']?.touched && f['City']?.invalid" class="text-danger">
              <small *ngIf="f['City']?.errors?.['maxlength']">City cannot exceed 100 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="State" class="form-label">State</label>
                      <input
                        type="text"
                        class="form-control"
                        id="State"
                        formControlName="State"
                        placeholder="Enter state"
                      >
            <div *ngIf="f['State']?.touched && f['State']?.invalid" class="text-danger">
              <small *ngIf="f['State']?.errors?.['maxlength']">State cannot exceed 100 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="Country" class="form-label">Country</label>
                      <input
                        type="text"
                        class="form-control"
                        id="Country"
                        formControlName="Country"
                        placeholder="Enter country"
                      >
            <div *ngIf="f['Country']?.touched && f['Country']?.invalid" class="text-danger">
              <small *ngIf="f['Country']?.errors?.['maxlength']">Country cannot exceed 100 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="PostalCode" class="form-label">Postal Code</label>
                      <input
                        type="text"
                        class="form-control"
                        id="PostalCode"
                        formControlName="PostalCode"
                        placeholder="Enter postal code"
                      >
            <div *ngIf="f['PostalCode']?.touched && f['PostalCode']?.invalid" class="text-danger">
              <small *ngIf="f['PostalCode']?.errors?.['maxlength']">Postal code cannot exceed 20 characters</small>
            </div>
                    </div>
                  </div>

                  <!-- Contact Information -->
                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="EmailAddress" class="form-label">Email Address</label>
                      <input
                        type="email"
                        class="form-control"
                        id="EmailAddress"
                        formControlName="EmailAddress"
                        placeholder="Enter email address"
                      >
            <div *ngIf="f['EmailAddress']?.touched && f['EmailAddress']?.invalid" class="text-danger">
              <small *ngIf="f['EmailAddress']?.errors?.['email']">Please enter a valid email address</small>
              <small *ngIf="f['EmailAddress']?.errors?.['maxlength']">Email address cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="PhoneNumber" class="form-label">Phone Number</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="PhoneNumber"
                        formControlName="PhoneNumber"
                        placeholder="Enter phone number"
                      >
            <div *ngIf="f['PhoneNumber']?.touched && f['PhoneNumber']?.invalid" class="text-danger">
              <small *ngIf="f['PhoneNumber']?.errors?.['maxlength']">Phone number cannot exceed 20 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="mb-3">
                      <label for="Fax" class="form-label">Fax</label>
                      <input
                        type="text"
                        class="form-control"
                        id="Fax"
                        formControlName="Fax"
                        placeholder="Enter fax number"
                      >
            <div *ngIf="f['Fax']?.touched && f['Fax']?.invalid" class="text-danger">
              <small *ngIf="f['Fax']?.errors?.['maxlength']">Fax number cannot exceed 20 characters</small>
            </div>
                    </div>
                  </div>

                  <div class="col-md-8">
                    <div class="mb-3">
                      <label for="Website" class="form-label">Website</label>
                      <input
                        type="url"
                        class="form-control"
                        id="Website"
                        formControlName="Website"
                        placeholder="Enter website URL"
                      >
            <div *ngIf="f['Website']?.touched && f['Website']?.invalid" class="text-danger">
              <small *ngIf="f['Website']?.errors?.['maxlength']">Website cannot exceed 255 characters</small>
            </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary me-2"
            (click)="onCancel()"
            [disabled]="isSubmitting"
          >
            <i class="fas fa-arrow-left me-2"></i>
            Cancel
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isSubmitting || companyForm.invalid"
          >
            <i class="fas fa-save me-2"></i>
            {{ isSubmitting ? 'Saving...' : (currentCompany ? 'Update Company' : 'Create Company') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>