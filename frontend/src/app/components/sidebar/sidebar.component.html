<div class="sidebar" 
     [class.collapsed]="isCollapsed"
     [class.mobile-open]="isMobileOpen">
  <div class="sidebar-header">
    <div class="logo-section">
      <img src="/assets/logos/PIC_Logo-removebg-preview.png" alt="PIC Logo" class="logo">
      <span class="logo-text" *ngIf="!(sidebarService.isCollapsed$ | async)">PIC Certificate</span>
    </div>
  </div>

  <!-- Profile Section -->
  <div class="profile-section">
    <div class="profile-card">
      <div class="profile-header">
        <div class="profile-avatar">
          <img [src]="getProfileImageUrl()" [alt]="currentUser?.firstName || 'User'" class="avatar-img" (error)="onImageError($event)">
          <div class="avatar-initials" *ngIf="!currentUser?.profileImage || currentUser?.profileImage === '/assets/images/default-profile-icon.png'">
            {{ getUserInitials() }}
          </div>
        </div>
        <div class="profile-info">
          <h3 class="profile-name">{{ getDisplayName() }}</h3>
          <p class="profile-role">{{ formatRole(currentUser?.role || currentUser?.userRole || currentUser?.roleName || 'User') }}</p>
          <div class="profile-location" *ngIf="currentUser?.location">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ currentUser.location }}</span>
          </div>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="stat-item">
          <div class="stat-label">User Type</div>
          <div class="stat-value">{{ formatRole(currentUser?.role || currentUser?.userRole || currentUser?.roleName || 'User') }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Department</div>
          <div class="stat-value">{{ currentUser?.department || 'N/A' }}</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Status</div>
          <div class="stat-value status-active">Active</div>
        </div>
      </div>
    </div>
  </div>

  <nav class="sidebar-nav">
    <ul class="nav-list">
      <li *ngFor="let item of menuItems" class="nav-item">
        <a
          *ngIf="!item.children"
          [routerLink]="item.route"
          class="nav-link"
          [class.active]="isActive(item.route!)">
          <i [class]="item.icon" class="nav-icon"></i>
          <span class="nav-text" *ngIf="!(sidebarService.isCollapsed$ | async)">{{ item.label }}</span>
        </a>

        <div *ngIf="item.children" class="nav-item-group">
          <a
            href="javascript:void(0)"
            class="nav-link nav-link-group"
            (click)="toggleSubmenu(item)">
            <i [class]="item.icon" class="nav-icon"></i>
          <span class="nav-text" *ngIf="!(sidebarService.isCollapsed$ | async)">{{ item.label }}</span>
          <i class="fas fa-chevron-down toggle-icon" [class.rotated]="item.isExpanded" *ngIf="!(sidebarService.isCollapsed$ | async)"></i>
          </a>

          <ul class="submenu" [class.expanded]="item.isExpanded">
            <li *ngFor="let child of item.children" class="submenu-item">
              <a
                [routerLink]="child.route"
                class="submenu-link"
                [class.active]="isActive(child.route!)">
                <i [class]="child.icon" class="submenu-icon"></i>
                <span class="submenu-text">{{ child.label }}</span>
              </a>
            </li>
          </ul>
        </div>
      </li>
    </ul>
  </nav>

  <div class="sidebar-footer">
    <button class="logout-btn" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i>
      <span *ngIf="!(sidebarService.isCollapsed$ | async)">Logout</span>
    </button>
  </div>
</div>
